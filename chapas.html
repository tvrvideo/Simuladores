<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Recortes Chapa</title>
    <style>:root { 
            --primary: #e74c3c; 
            --background-paper: #DEDDCE; 
            --input-bg: #FFFCE6; 
        }


        body {
            font-family: Arial, sans-serif;
            margin: 25px;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 900px;
            margin: auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1, h2 {
            color: #333;
            text-align: center;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="number"], select {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            font-size: 16px;
            margin-top: 5px;
        }
        button.remove-btn {
            width: auto;
            padding: 5px 10px;
            background-color: #dc3545;
        }
        button.remove-btn:hover {
            background-color: #c82333;
        }
        button:hover {
            background-color: #0056b3;
        }
        .section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        .results-container {
            margin-top: 20px;
        }
        .color-section {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }
        .color-title {
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
            color: white;
            text-shadow: 1px 1px 2px #000;
        }
        .cut-list {
            list-style-type: none;
            padding: 0;
        }
        .cut-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        .cut-item:last-child {
            border-bottom: none;
        }
        .cut-info {
            cursor: pointer;
            flex-grow: 1;
            padding: 8px;
        }
        .search-results-container {
            margin-top: 15px;
            padding: 10px;
            border: 1px solid #28a745;
            background-color: #d4edda;
            color: #155724;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
        }
        .search-results-container.no-results {
            border-color: #dc3545;
            background-color: #f8d7da;
            color: #721c24;
        }
        .search-results-container .search-result-item {
            padding: 5px 0;
            border-bottom: 1px solid #c3e6cb;
        }
        .search-results-container.no-results .search-result-item {
             border-bottom: 1px solid #f5c6cb;
        }
        .search-results-container .search-result-item:last-child {
            border-bottom: none;
        }
        /* Estilos del modal de edición */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 400px;
            border-radius: 8px;
            text-align: center;
        }
        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-btn:hover,
        .close-btn:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        .modal-buttons {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-top: 20px;
        }
        .modal-buttons button {
            flex-grow: 1;
        }
        .db-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 10px;
            margin-top: 20px;
        }
        .db-buttons button {
            flex-grow: 1;
            margin-bottom: 10px;
        }
        .sort-buttons {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
        }
        .sort-buttons button {
            width: 48%;
            background-color: #4CAF50;
        }

.btn-menu { 
            position: fixed; top: 10px; left: 10px; z-index: 9999; 
            padding: 10px 15px; border-radius: 20px; border: none; 
            background: var(--primary); color: white; font-weight: bold; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); cursor: pointer;
            font-size: 0.9rem;
        }


/* FIX: evitar que reglas generales de button (width:100%) lo estiren */
.btn-menu{
  width: auto !important;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

</style>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Ventanas Rey">
<link rel="icon" href="logo.png">
<link rel="apple-touch-icon" href="logo.png">
<link rel="manifest" href="manifest.json"></head>
<body>

<button class="btn-menu" onclick="if(window.parent && window.parent.volverMenu){window.parent.volverMenu()} else { window.location.href = 'index.html'; }">← MENÚ</button>





<div class="container">
    <h1>Recortes de Chapa</h1>
    
    <div class="section">
        <h2>Buscador</h2>
        <div class="form-group">
            <label for="search-ral-select">Color RAL a buscar:</label>
            <select id="search-ral-select">
                <option value="all">Buscar Todo</option>
                <option value="1015">RAL 1015 - Ivory</option>
                <option value="1036">RAL 1036 - Oro</option>
                <option value="2004">RAL 2004 - Naranja</option>
                <option value="2015">RAL 2015 - Beige</option>
                <option value="3005">RAL 3005 - Rojo Vino</option>
                <option value="5010">RAL 5010 - Azul Genciana</option>
                <option value="6005">RAL 6005 - Verde</option>
                <option value="6009">RAL 6009 - Verde Abeto</option>
                <option value="7016">RAL 7016 - Gris Antracita</option>
                <option value="7035">RAL 7035 - Natural</option>
                <option value="7043">RAL 7043 - Gris</option>
                <option value="8003">RAL 8003 - Roble Dorado</option>
                <option value="8004">RAL 8004 - Cobre</option>
                <option value="8011">RAL 8011 - Nogal</option>
                <option value="8014">RAL 8014 - Marrón</option>
                <option value="8017">RAL 8017 - Bronce</option>
                <option value="9005">RAL 9005 - Negro Intenso</option>
                <option value="9010">RAL 9010 - Blanco Puro</option>
                <option value="1733">RAL 1733 - Inox</option>
            </select>
        </div>
        <div class="form-group">
            <label for="search-long-input">Largo deseado:</label>
            <input type="number" id="search-long-input" placeholder="Ej: 2000">
        </div>
        <div class="form-group">
            <label for="search-short-input">Corto deseado:</label>
            <input type="number" id="search-short-input" placeholder="Ej: 1000">
        </div>
        <button id="search-cut-btn">Buscar Chapa</button>
        <div id="search-results-container" class="search-results-container no-results"><p class="search-result-item">No se encontraron chapas que cumplan con las medidas especificadas.</p></div>
    </div>
    
    <hr>

    <div class="section">
        <h2>Añadir Recorte</h2>
        <div class="form-group">
            <label for="ral-select">Color RAL:</label>
            <select id="ral-select">
                <option value="1015">RAL 1015 - Ivory</option>
                <option value="1036">RAL 1036 - Oro</option>
                <option value="2004">RAL 2004 - Naranja</option>
                <option value="2015">RAL 2015 - Beige</option>
                <option value="3005">RAL 3005 - Rojo Vino</option>
                <option value="5010">RAL 5010 - Azul Genciana</option>
                <option value="6005">RAL 6005 - Verde</option>
                <option value="6009">RAL 6009 - Verde Abeto</option>
                <option value="7016">RAL 7016 - Gris Antracita</option>
                <option value="7035">RAL 7035 - Natural</option>
                <option value="7043">RAL 7043 - Gris</option>
                <option value="8003">RAL 8003 - Roble Dorado</option>
                <option value="8004">RAL 8004 - Cobre</option>
                <option value="8011">RAL 8011 - Nogal</option>
                <option value="8014">RAL 8014 - Marrón</option>
                <option value="8017">RAL 8017 - Bronce</option>
                <option value="9005">RAL 9005 - Negro Intenso</option>
                <option value="9010">RAL 9010 - Blanco Puro</option>
                <option value="1733">RAL 1733 - Inox</option>
            </select>
        </div>
        <div class="form-group">
            <label for="long-input">Largo:</label>
            <input type="number" id="long-input" placeholder="Ej: 2000" required="">
        </div>
        <div class="form-group">
            <label for="short-input">Corto:</label>
            <input type="number" id="short-input" placeholder="Ej: 1000" required="">
        </div>
        <div class="form-group">
            <label for="faces-select">Caras Lacadas:</label>
            <select id="faces-select">
                <option value="1">1 Cara</option>
                <option value="2">2 Caras</option>
            </select>
        </div>
        <div class="form-group">
            <label for="count-input">Número de chapas:</label>
            <input type="number" id="count-input" value="1" min="1" required="">
        </div>
        <button id="add-cut-btn">Añadir Recorte</button>
    </div>

    <hr>

    <div class="section">
        <h2>Recortes por Color</h2>
        <div class="sort-buttons">
            <button id="sort-long-btn">Ordenar por Largo</button>
            <button id="sort-short-btn">Ordenar por Corto</button>
        </div>
        <div id="results-container"><div class="color-section" style="background-color: rgb(216, 198, 179);"><h3 class="color-title" style="color: rgb(51, 51, 51);">RAL 1015 - Ivory</h3><ul class="cut-list"><li class="cut-item">
                        <span class="cut-info" data-ral="1015" data-index="0" style="color: #333;">162 X 77 | 1</span>
                        <button class="remove-btn" data-ral="1015" data-index="0">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="1015" data-index="1" style="color: #333;">129 X 125 | 1</span>
                        <button class="remove-btn" data-ral="1015" data-index="1">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="1015" data-index="2" style="color: #333;">60 X 46 | 2</span>
                        <button class="remove-btn" data-ral="1015" data-index="2">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="1015" data-index="3" style="color: #333;">53 X 46 | 1</span>
                        <button class="remove-btn" data-ral="1015" data-index="3">Quitar</button>
                    </li></ul></div><div class="color-section" style="background-color: rgb(158, 140, 103);"><h3 class="color-title" style="color: rgb(51, 51, 51);">RAL 1036 - Oro</h3><ul class="cut-list"><li class="cut-item">
                        <span class="cut-info" data-ral="1036" data-index="0" style="color: #333;">100 X 65 | 1</span>
                        <button class="remove-btn" data-ral="1036" data-index="0">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="1036" data-index="1" style="color: #333;">100 X 46 | 1</span>
                        <button class="remove-btn" data-ral="1036" data-index="1">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="1036" data-index="2" style="color: #333;">67 X 26 | 1</span>
                        <button class="remove-btn" data-ral="1036" data-index="2">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="1036" data-index="3" style="color: #333;">67 X 19 | 1</span>
                        <button class="remove-btn" data-ral="1036" data-index="3">Quitar</button>
                    </li></ul></div><div class="color-section" style="background-color: rgb(169, 169, 169);"><h3 class="color-title" style="color: rgb(51, 51, 51);">RAL 1733 - Inox</h3><ul class="cut-list"><li class="cut-item">
                        <span class="cut-info" data-ral="1733" data-index="0" style="color: #333;">130 X 39 | 1</span>
                        <button class="remove-btn" data-ral="1733" data-index="0">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="1733" data-index="1" style="color: #333;">125 X 37 | 1</span>
                        <button class="remove-btn" data-ral="1733" data-index="1">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="1733" data-index="2" style="color: #333;">100 X 26 | 1</span>
                        <button class="remove-btn" data-ral="1733" data-index="2">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="1733" data-index="3" style="color: #333;">85 X 29 | 1</span>
                        <button class="remove-btn" data-ral="1733" data-index="3">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="1733" data-index="4" style="color: #333;">82 X 34 | 1</span>
                        <button class="remove-btn" data-ral="1733" data-index="4">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="1733" data-index="5" style="color: #333;">78 X 24 | 1</span>
                        <button class="remove-btn" data-ral="1733" data-index="5">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="1733" data-index="6" style="color: #333;">68 X 51 | 1</span>
                        <button class="remove-btn" data-ral="1733" data-index="6">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="1733" data-index="7" style="color: #333;">60 X 25 | 1</span>
                        <button class="remove-btn" data-ral="1733" data-index="7">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="1733" data-index="8" style="color: #333;">58 X 37 | 1</span>
                        <button class="remove-btn" data-ral="1733" data-index="8">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="1733" data-index="9" style="color: #333;">56 X 37 | 1</span>
                        <button class="remove-btn" data-ral="1733" data-index="9">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="1733" data-index="10" style="color: #333;">46 X 25 | 1</span>
                        <button class="remove-btn" data-ral="1733" data-index="10">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="1733" data-index="11" style="color: #333;">43 X 43 | 1</span>
                        <button class="remove-btn" data-ral="1733" data-index="11">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="1733" data-index="12" style="color: #333;">38 X 34 | 1</span>
                        <button class="remove-btn" data-ral="1733" data-index="12">Quitar</button>
                    </li></ul></div><div class="color-section" style="background-color: rgb(244, 108, 36);"><h3 class="color-title" style="color: rgb(51, 51, 51);">RAL 2004 - Naranja</h3><ul class="cut-list"><li class="cut-item">
                        <span class="cut-info" data-ral="2004" data-index="0" style="color: #333;">153 X 125 | 1</span>
                        <button class="remove-btn" data-ral="2004" data-index="0">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="2004" data-index="1" style="color: #333;">147 X 25 | 1</span>
                        <button class="remove-btn" data-ral="2004" data-index="1">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="2004" data-index="2" style="color: #333;">74 X 49 | 2</span>
                        <button class="remove-btn" data-ral="2004" data-index="2">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="2004" data-index="3" style="color: #333;">49 X 48 | 1</span>
                        <button class="remove-btn" data-ral="2004" data-index="3">Quitar</button>
                    </li></ul></div><div class="color-section" style="background-color: rgb(224, 152, 103);"><h3 class="color-title" style="color: rgb(51, 51, 51);">RAL 2015 - Beige</h3><ul class="cut-list"><li class="cut-item">
                        <span class="cut-info" data-ral="2015" data-index="0" style="color: #333;">66 X 33 | 1 | Caras 2</span>
                        <button class="remove-btn" data-ral="2015" data-index="0">Quitar</button>
                    </li></ul></div><div class="color-section" style="background-color: rgb(108, 43, 51);"><h3 class="color-title" style="color: rgb(244, 244, 244);">RAL 3005 - Rojo Vino</h3><ul class="cut-list"><li class="cut-item">
                        <span class="cut-info" data-ral="3005" data-index="0" style="color: #f4f4f4;">156 X 125 | 1 | Caras 2</span>
                        <button class="remove-btn" data-ral="3005" data-index="0">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="3005" data-index="1" style="color: #f4f4f4;">54 X 47 | 2 | Caras 2</span>
                        <button class="remove-btn" data-ral="3005" data-index="1">Quitar</button>
                    </li></ul></div><div class="color-section" style="background-color: rgb(0, 91, 138);"><h3 class="color-title" style="color: rgb(244, 244, 244);">RAL 5010 - Azul Genciana</h3><ul class="cut-list"><li class="cut-item">
                        <span class="cut-info" data-ral="5010" data-index="0" style="color: #f4f4f4;">125 X 114 | 1</span>
                        <button class="remove-btn" data-ral="5010" data-index="0">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="5010" data-index="1" style="color: #f4f4f4;">113 X 22 | 1</span>
                        <button class="remove-btn" data-ral="5010" data-index="1">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="5010" data-index="2" style="color: #f4f4f4;">79 X 19 | 1</span>
                        <button class="remove-btn" data-ral="5010" data-index="2">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="5010" data-index="3" style="color: #f4f4f4;">76 X 32 | 1</span>
                        <button class="remove-btn" data-ral="5010" data-index="3">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="5010" data-index="4" style="color: #f4f4f4;">69 X 32 | 1</span>
                        <button class="remove-btn" data-ral="5010" data-index="4">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="5010" data-index="5" style="color: #f4f4f4;">68 X 25 | 1</span>
                        <button class="remove-btn" data-ral="5010" data-index="5">Quitar</button>
                    </li></ul></div><div class="color-section" style="background-color: rgb(15, 60, 47);"><h3 class="color-title" style="color: rgb(244, 244, 244);">RAL 6005 - Verde</h3><ul class="cut-list"><li class="cut-item">
                        <span class="cut-info" data-ral="6005" data-index="0" style="color: #f4f4f4;">131 X 115 | 1</span>
                        <button class="remove-btn" data-ral="6005" data-index="0">Quitar</button>
                    </li></ul></div><div class="color-section" style="background-color: rgb(61, 68, 49);"><h3 class="color-title" style="color: rgb(244, 244, 244);">RAL 6009 - Verde Abeto</h3><ul class="cut-list"><li class="cut-item">
                        <span class="cut-info" data-ral="6009" data-index="0" style="color: #f4f4f4;">125 X 87 | 1</span>
                        <button class="remove-btn" data-ral="6009" data-index="0">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="6009" data-index="1" style="color: #f4f4f4;">122 X 20 | 1</span>
                        <button class="remove-btn" data-ral="6009" data-index="1">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="6009" data-index="2" style="color: #f4f4f4;">121 X 109 | 1</span>
                        <button class="remove-btn" data-ral="6009" data-index="2">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="6009" data-index="3" style="color: #f4f4f4;">109 X 61 | 1</span>
                        <button class="remove-btn" data-ral="6009" data-index="3">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="6009" data-index="4" style="color: #f4f4f4;">98 X 50 | 1</span>
                        <button class="remove-btn" data-ral="6009" data-index="4">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="6009" data-index="5" style="color: #f4f4f4;">97 X 20 | 1</span>
                        <button class="remove-btn" data-ral="6009" data-index="5">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="6009" data-index="6" style="color: #f4f4f4;">91 X 21 | 1</span>
                        <button class="remove-btn" data-ral="6009" data-index="6">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="6009" data-index="7" style="color: #f4f4f4;">85 X 42 | 1</span>
                        <button class="remove-btn" data-ral="6009" data-index="7">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="6009" data-index="8" style="color: #f4f4f4;">79 X 30 | 1</span>
                        <button class="remove-btn" data-ral="6009" data-index="8">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="6009" data-index="9" style="color: #f4f4f4;">79 X 45 | 1</span>
                        <button class="remove-btn" data-ral="6009" data-index="9">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="6009" data-index="10" style="color: #f4f4f4;">75 X 30 | 1</span>
                        <button class="remove-btn" data-ral="6009" data-index="10">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="6009" data-index="11" style="color: #f4f4f4;">75 X 25 | 1</span>
                        <button class="remove-btn" data-ral="6009" data-index="11">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="6009" data-index="12" style="color: #f4f4f4;">74 X 34 | 1</span>
                        <button class="remove-btn" data-ral="6009" data-index="12">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="6009" data-index="13" style="color: #f4f4f4;">73 X 20 | 1</span>
                        <button class="remove-btn" data-ral="6009" data-index="13">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="6009" data-index="14" style="color: #f4f4f4;">65 X 64 | 1</span>
                        <button class="remove-btn" data-ral="6009" data-index="14">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="6009" data-index="15" style="color: #f4f4f4;">59 X 45 | 3</span>
                        <button class="remove-btn" data-ral="6009" data-index="15">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="6009" data-index="16" style="color: #f4f4f4;">50 X 47 | 1</span>
                        <button class="remove-btn" data-ral="6009" data-index="16">Quitar</button>
                    </li></ul></div><div class="color-section" style="background-color: rgb(204, 210, 210);"><h3 class="color-title" style="color: rgb(51, 51, 51);">RAL 7035 - Natural</h3><ul class="cut-list"><li class="cut-item">
                        <span class="cut-info" data-ral="7035" data-index="0" style="color: #333;">91 X 20 | 1</span>
                        <button class="remove-btn" data-ral="7035" data-index="0">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="7035" data-index="1" style="color: #333;">88 X 38 | 1</span>
                        <button class="remove-btn" data-ral="7035" data-index="1">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="7035" data-index="2" style="color: #333;">81 X 47 | 1</span>
                        <button class="remove-btn" data-ral="7035" data-index="2">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="7035" data-index="3" style="color: #333;">75 X 43 | 1</span>
                        <button class="remove-btn" data-ral="7035" data-index="3">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="7035" data-index="4" style="color: #333;">70 X 39 | 1</span>
                        <button class="remove-btn" data-ral="7035" data-index="4">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="7035" data-index="5" style="color: #333;">68 X 65 | 1</span>
                        <button class="remove-btn" data-ral="7035" data-index="5">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="7035" data-index="6" style="color: #333;">66 X 40 | 1</span>
                        <button class="remove-btn" data-ral="7035" data-index="6">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="7035" data-index="7" style="color: #333;">65 X 44 | 1</span>
                        <button class="remove-btn" data-ral="7035" data-index="7">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="7035" data-index="8" style="color: #333;">62 X 45 | 1</span>
                        <button class="remove-btn" data-ral="7035" data-index="8">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="7035" data-index="9" style="color: #333;">60 X 56 | 1</span>
                        <button class="remove-btn" data-ral="7035" data-index="9">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="7035" data-index="10" style="color: #333;">58 X 53 | 1</span>
                        <button class="remove-btn" data-ral="7035" data-index="10">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="7035" data-index="11" style="color: #333;">50 X 43 | 1</span>
                        <button class="remove-btn" data-ral="7035" data-index="11">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="7035" data-index="12" style="color: #333;">48 X 46 | 1</span>
                        <button class="remove-btn" data-ral="7035" data-index="12">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="7035" data-index="13" style="color: #333;">46 X 26 | 1</span>
                        <button class="remove-btn" data-ral="7035" data-index="13">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="7035" data-index="14" style="color: #333;">46 X 28 | 1</span>
                        <button class="remove-btn" data-ral="7035" data-index="14">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="7035" data-index="15" style="color: #333;">32 X 31 | 1</span>
                        <button class="remove-btn" data-ral="7035" data-index="15">Quitar</button>
                    </li></ul></div><div class="color-section" style="background-color: rgb(93, 100, 104);"><h3 class="color-title" style="color: rgb(244, 244, 244);">RAL 7043 - Gris</h3><ul class="cut-list"><li class="cut-item">
                        <span class="cut-info" data-ral="7043" data-index="0" style="color: #f4f4f4;">108 X 25 | 1</span>
                        <button class="remove-btn" data-ral="7043" data-index="0">Quitar</button>
                    </li></ul></div><div class="color-section" style="background-color: rgb(158, 86, 71);"><h3 class="color-title" style="color: rgb(244, 244, 244);">RAL 8004 - Cobre</h3><ul class="cut-list"><li class="cut-item">
                        <span class="cut-info" data-ral="8004" data-index="0" style="color: #f4f4f4;">127 X 125 | 1</span>
                        <button class="remove-btn" data-ral="8004" data-index="0">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="8004" data-index="1" style="color: #f4f4f4;">61 X 59 | 1</span>
                        <button class="remove-btn" data-ral="8004" data-index="1">Quitar</button>
                    </li></ul></div><div class="color-section" style="background-color: rgb(109, 71, 52);"><h3 class="color-title" style="color: rgb(244, 244, 244);">RAL 8011 - Nogal</h3><ul class="cut-list"><li class="cut-item">
                        <span class="cut-info" data-ral="8011" data-index="0" style="color: #f4f4f4;">90 X 56 | 1</span>
                        <button class="remove-btn" data-ral="8011" data-index="0">Quitar</button>
                    </li></ul></div><div class="color-section" style="background-color: rgb(77, 59, 49);"><h3 class="color-title" style="color: rgb(244, 244, 244);">RAL 8014 - Marrón</h3><ul class="cut-list"><li class="cut-item">
                        <span class="cut-info" data-ral="8014" data-index="0" style="color: #f4f4f4;">125 X 101 | 1</span>
                        <button class="remove-btn" data-ral="8014" data-index="0">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="8014" data-index="1" style="color: #f4f4f4;">70 X 41 | 1</span>
                        <button class="remove-btn" data-ral="8014" data-index="1">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="8014" data-index="2" style="color: #f4f4f4;">66 X 42 | 1</span>
                        <button class="remove-btn" data-ral="8014" data-index="2">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="8014" data-index="3" style="color: #f4f4f4;">65 X 39 | 1</span>
                        <button class="remove-btn" data-ral="8014" data-index="3">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="8014" data-index="4" style="color: #f4f4f4;">63 X 60 | 1</span>
                        <button class="remove-btn" data-ral="8014" data-index="4">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="8014" data-index="5" style="color: #f4f4f4;">61 X 54 | 1</span>
                        <button class="remove-btn" data-ral="8014" data-index="5">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="8014" data-index="6" style="color: #f4f4f4;">59 X 45 | 1</span>
                        <button class="remove-btn" data-ral="8014" data-index="6">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="8014" data-index="7" style="color: #f4f4f4;">58 X 57 | 1</span>
                        <button class="remove-btn" data-ral="8014" data-index="7">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="8014" data-index="8" style="color: #f4f4f4;">57 X 56 | 1</span>
                        <button class="remove-btn" data-ral="8014" data-index="8">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="8014" data-index="9" style="color: #f4f4f4;">57 X 53 | 1</span>
                        <button class="remove-btn" data-ral="8014" data-index="9">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="8014" data-index="10" style="color: #f4f4f4;">57 X 52 | 1</span>
                        <button class="remove-btn" data-ral="8014" data-index="10">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="8014" data-index="11" style="color: #f4f4f4;">54 X 50 | 1</span>
                        <button class="remove-btn" data-ral="8014" data-index="11">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="8014" data-index="12" style="color: #f4f4f4;">51 X 43 | 1</span>
                        <button class="remove-btn" data-ral="8014" data-index="12">Quitar</button>
                    </li></ul></div><div class="color-section" style="background-color: rgb(94, 67, 52);"><h3 class="color-title" style="color: rgb(244, 244, 244);">RAL 8017 - Bronce</h3><ul class="cut-list"><li class="cut-item">
                        <span class="cut-info" data-ral="8017" data-index="0" style="color: #f4f4f4;">170 X 125 | 1</span>
                        <button class="remove-btn" data-ral="8017" data-index="0">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="8017" data-index="1" style="color: #f4f4f4;">138 X 24 | 1</span>
                        <button class="remove-btn" data-ral="8017" data-index="1">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="8017" data-index="2" style="color: #f4f4f4;">129 X 94 | 1</span>
                        <button class="remove-btn" data-ral="8017" data-index="2">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="8017" data-index="3" style="color: #f4f4f4;">127 X 125 | 1</span>
                        <button class="remove-btn" data-ral="8017" data-index="3">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="8017" data-index="4" style="color: #f4f4f4;">125 X 67 | 1</span>
                        <button class="remove-btn" data-ral="8017" data-index="4">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="8017" data-index="5" style="color: #f4f4f4;">90 X 23 | 1</span>
                        <button class="remove-btn" data-ral="8017" data-index="5">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="8017" data-index="6" style="color: #f4f4f4;">84 X 25 | 1</span>
                        <button class="remove-btn" data-ral="8017" data-index="6">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="8017" data-index="7" style="color: #f4f4f4;">80 X 20 | 1</span>
                        <button class="remove-btn" data-ral="8017" data-index="7">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="8017" data-index="8" style="color: #f4f4f4;">77 X 19 | 2</span>
                        <button class="remove-btn" data-ral="8017" data-index="8">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="8017" data-index="9" style="color: #f4f4f4;">74 X 19 | 1</span>
                        <button class="remove-btn" data-ral="8017" data-index="9">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="8017" data-index="10" style="color: #f4f4f4;">63 X 47 | 1</span>
                        <button class="remove-btn" data-ral="8017" data-index="10">Quitar</button>
                    </li></ul></div><div class="color-section" style="background-color: rgb(13, 13, 13);"><h3 class="color-title" style="color: rgb(244, 244, 244);">RAL 9005 - Negro Intenso</h3><ul class="cut-list"><li class="cut-item">
                        <span class="cut-info" data-ral="9005" data-index="0" style="color: #f4f4f4;">77 X 24 | 1</span>
                        <button class="remove-btn" data-ral="9005" data-index="0">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9005" data-index="1" style="color: #f4f4f4;">71 X 38 | 1</span>
                        <button class="remove-btn" data-ral="9005" data-index="1">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9005" data-index="2" style="color: #f4f4f4;">68 X 39 | 1 | Caras 2</span>
                        <button class="remove-btn" data-ral="9005" data-index="2">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9005" data-index="3" style="color: #f4f4f4;">68 X 64 | 1</span>
                        <button class="remove-btn" data-ral="9005" data-index="3">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9005" data-index="4" style="color: #f4f4f4;">66 X 36 | 1 | Caras 2</span>
                        <button class="remove-btn" data-ral="9005" data-index="4">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9005" data-index="5" style="color: #f4f4f4;">46 X 38 | 1</span>
                        <button class="remove-btn" data-ral="9005" data-index="5">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9005" data-index="6" style="color: #f4f4f4;">36 X 34 | 1</span>
                        <button class="remove-btn" data-ral="9005" data-index="6">Quitar</button>
                    </li></ul></div><div class="color-section" style="background-color: rgb(247, 249, 239);"><h3 class="color-title" style="color: rgb(51, 51, 51);">RAL 9010 - Blanco Puro</h3><ul class="cut-list"><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="0" style="color: #333;">150 X 50 | 1</span>
                        <button class="remove-btn" data-ral="9010" data-index="0">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="1" style="color: #333;">147 X 43 | 1</span>
                        <button class="remove-btn" data-ral="9010" data-index="1">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="2" style="color: #333;">138 X 92 | 1 | Caras 2</span>
                        <button class="remove-btn" data-ral="9010" data-index="2">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="3" style="color: #333;">125 X 60 | 1</span>
                        <button class="remove-btn" data-ral="9010" data-index="3">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="4" style="color: #333;">123 X 33 | 1</span>
                        <button class="remove-btn" data-ral="9010" data-index="4">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="5" style="color: #333;">111 X 45 | 1</span>
                        <button class="remove-btn" data-ral="9010" data-index="5">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="6" style="color: #333;">96 X 45 | 1</span>
                        <button class="remove-btn" data-ral="9010" data-index="6">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="7" style="color: #333;">80 X 43 | 1</span>
                        <button class="remove-btn" data-ral="9010" data-index="7">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="8" style="color: #333;">79 X 41 | 1</span>
                        <button class="remove-btn" data-ral="9010" data-index="8">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="9" style="color: #333;">74 X 39 | 1</span>
                        <button class="remove-btn" data-ral="9010" data-index="9">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="10" style="color: #333;">72 X 46 | 1</span>
                        <button class="remove-btn" data-ral="9010" data-index="10">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="11" style="color: #333;">69 X 44 | 1</span>
                        <button class="remove-btn" data-ral="9010" data-index="11">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="12" style="color: #333;">68 X 58 | 1</span>
                        <button class="remove-btn" data-ral="9010" data-index="12">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="13" style="color: #333;">67 X 47 | 1</span>
                        <button class="remove-btn" data-ral="9010" data-index="13">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="14" style="color: #333;">65 X 38 | 1 | Caras 2</span>
                        <button class="remove-btn" data-ral="9010" data-index="14">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="15" style="color: #333;">64 X 27 | 1</span>
                        <button class="remove-btn" data-ral="9010" data-index="15">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="16" style="color: #333;">64 X 33 | 1</span>
                        <button class="remove-btn" data-ral="9010" data-index="16">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="17" style="color: #333;">63 X 31 | 1 | Caras 2</span>
                        <button class="remove-btn" data-ral="9010" data-index="17">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="18" style="color: #333;">59 X 44 | 1 | Caras 2</span>
                        <button class="remove-btn" data-ral="9010" data-index="18">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="19" style="color: #333;">58 X 46 | 1</span>
                        <button class="remove-btn" data-ral="9010" data-index="19">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="20" style="color: #333;">51 X 47 | 2</span>
                        <button class="remove-btn" data-ral="9010" data-index="20">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="21" style="color: #333;">50 X 32 | 1 | Caras 2</span>
                        <button class="remove-btn" data-ral="9010" data-index="21">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="22" style="color: #333;">50 X 47 | 1 | Caras 2</span>
                        <button class="remove-btn" data-ral="9010" data-index="22">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="23" style="color: #333;">49 X 36 | 1</span>
                        <button class="remove-btn" data-ral="9010" data-index="23">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="24" style="color: #333;">48 X 35 | 1 | Caras 2</span>
                        <button class="remove-btn" data-ral="9010" data-index="24">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="25" style="color: #333;">48 X 40 | 1 | Caras 2</span>
                        <button class="remove-btn" data-ral="9010" data-index="25">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="26" style="color: #333;">47 X 30 | 1</span>
                        <button class="remove-btn" data-ral="9010" data-index="26">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="27" style="color: #333;">47 X 40 | 1</span>
                        <button class="remove-btn" data-ral="9010" data-index="27">Quitar</button>
                    </li><li class="cut-item">
                        <span class="cut-info" data-ral="9010" data-index="28" style="color: #333;">38 X 33 | 1</span>
                        <button class="remove-btn" data-ral="9010" data-index="28">Quitar</button>
                    </li></ul></div></div>
    </div>

    <hr>

    <div class="section">
        <h2>Gestionar Datos</h2>
        <div class="db-buttons">
            <button id="export-json-btn">Exportar a JSON (Escritorio)</button>
            <button id="export-csv-btn">Exportar a CSV (Escritorio)</button>
            <button id="export-json-ios-btn">Exportar JSON (iOS)</button>
            <button id="export-csv-ios-btn">Exportar CSV (iOS)</button>
            <button id="import-btn">Importar Base de Datos</button>
        </div>
        <input type="file" id="import-file" style="display:none;">
    </div>
</div>

<div id="editModal" class="modal">
    <div class="modal-content">
        <span class="close-btn">×</span>
        <h3>Modificar Recorte</h3>
        <div class="form-group">
            <label for="modal-long">Largo:</label>
            <input type="number" id="modal-long">
        </div>
        <div class="form-group">
            <label for="modal-short">Corto:</label>
            <input type="number" id="modal-short">
        </div>
        <div class="form-group">
            <label for="modal-faces">Caras Lacadas:</label>
            <select id="modal-faces">
                <option value="1">1 Cara</option>
                <option value="2">2 Caras</option>
            </select>
        </div>
        <div class="form-group">
            <label for="modal-count">Cantidad:</label>
            <input type="number" id="modal-count" min="0">
        </div>
        <div class="modal-buttons">
            <button id="save-edit-btn">Guardar</button>
            <button id="cancel-edit-btn">Cancelar</button>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const addCutBtn = document.getElementById('add-cut-btn');
        const searchCutBtn = document.getElementById('search-cut-btn');
        const ralSelect = document.getElementById('ral-select');
        const longInput = document.getElementById('long-input');
        const shortInput = document.getElementById('short-input');
        const facesSelect = document.getElementById('faces-select');
        const countInput = document.getElementById('count-input');
        const resultsContainer = document.getElementById('results-container');
        const searchRalSelect = document.getElementById('search-ral-select');
        const searchLongInput = document.getElementById('search-long-input');
        const searchShortInput = document.getElementById('search-short-input');
        const searchResultsContainer = document.getElementById('search-results-container');

        const sortLongBtn = document.getElementById('sort-long-btn');
        const sortShortBtn = document.getElementById('sort-short-btn');

        const editModal = document.getElementById('editModal');
        const closeBtn = document.querySelector('.close-btn');
        const saveEditBtn = document.getElementById('save-edit-btn');
        const cancelEditBtn = document.getElementById('cancel-edit-btn');
        const modalLongInput = document.getElementById('modal-long');
        const modalShortInput = document.getElementById('modal-short');
        const modalFacesSelect = document.getElementById('modal-faces');
        const modalCountInput = document.getElementById('modal-count');

        const exportJsonBtn = document.getElementById('export-json-btn');
        const exportCsvBtn = document.getElementById('export-csv-btn');
        const exportJsonIosBtn = document.getElementById('export-json-ios-btn');
        const exportCsvIosBtn = document.getElementById('export-csv-ios-btn');
        const importBtn = document.getElementById('import-btn');
        const importFile = document.getElementById('import-file');

        let currentEditInfo = {};
        let currentSortOrder = 'long';

        const ralColors = {
            '1015': { hex: '#d8c6b3', name: 'Ivory' },
            '1036': { hex: '#9e8c67', name: 'Oro' },
            '2004': { hex: '#f46c24', name: 'Naranja' },
            '2015': { hex: '#e09867', name: 'Beige' },
            '3005': { hex: '#6c2b33', name: 'Rojo Vino' },
            '5010': { hex: '#005b8a', name: 'Azul Genciana' },
            '6005': { hex: '#0f3c2f', name: 'Verde' },
            '6009': { hex: '#3d4431', name: 'Verde Abeto' },
            '7016': { hex: '#383e42', name: 'Gris Antracita' },
            '7035': { hex: '#ccd2d2', name: 'Natural' },
            '7043': { hex: '#5d6468', name: 'Gris' },
            '8003': { hex: '#b98135', name: 'Roble Dorado' },
            '8004': { hex: '#9e5647', name: 'Cobre' },
            '8011': { hex: '#6d4734', name: 'Nogal' },
            '8014': { hex: '#4d3b31', name: 'Marrón' },
            '8017': { hex: '#5e4334', name: 'Bronce' },
            '9005': { hex: '#0d0d0d', name: 'Negro Intenso' },
            '9010': { hex: '#f7f9ef', name: 'Blanco Puro' },
            '1733': { hex: '#a9a9a9', name: 'Inox' }
        };

        // Mapeo del antiguo RAL 9006 al nuevo 9010 para la carga inicial
        function migrateOldData(data) {
            if (data['9006']) {
                if (!data['9010']) {
                    data['9010'] = [];
                }
                data['9010'] = data['9010'].concat(data['9006']);
                delete data['9006'];
            }
            if (data['1013']) {
                delete data['1013'];
            }
            return data;
        }

        let cutsByRAL = JSON.parse(localStorage.getItem('cutsByRAL')) || {};
        cutsByRAL = migrateOldData(cutsByRAL);

        function saveCuts() {
            localStorage.setItem('cutsByRAL', JSON.stringify(cutsByRAL));
        }

        function getLuminance(hex) {
            const r = parseInt(hex.substring(1, 3), 16) / 255;
            const g = parseInt(hex.substring(3, 5), 16) / 255;
            const b = parseInt(hex.substring(5, 7), 16) / 255;
            const luminance = 0.2126 * r + 0.7152 * g + 0.0722 * b;
            return luminance;
        }

        function renderCuts() {
            resultsContainer.innerHTML = '';
            for (const ral in cutsByRAL) {
                const colorData = ralColors[ral];
                const colorHex = colorData ? colorData.hex : '#ccc';
                const colorName = colorData ? colorData.name : '';
                const titleText = colorName ? `RAL ${ral} - ${colorName}` : `RAL ${ral}`;

                // Ordenar los recortes según el criterio actual
                if (currentSortOrder === 'long') {
                    cutsByRAL[ral].sort((a, b) => b.long - a.long);
                } else {
                    cutsByRAL[ral].sort((a, b) => b.short - a.short);
                }

                const isDark = getLuminance(colorHex) < 0.5;
                const textColor = isDark ? '#f4f4f4' : '#333';

                const colorDiv = document.createElement('div');
                colorDiv.className = 'color-section';
                colorDiv.style.backgroundColor = colorHex;
                colorDiv.innerHTML = `<h3 class="color-title">${titleText}</h3><ul class="cut-list"></ul>`;
                colorDiv.querySelector('.color-title').style.color = textColor;

                const cutList = colorDiv.querySelector('ul');
                cutsByRAL[ral].forEach((cut, index) => {
                    const listItem = document.createElement('li');
                    listItem.className = 'cut-item';

                    let cutText = `${cut.long} X ${cut.short} | ${cut.count}`;
                    if (cut.faces === 2) {
                        cutText += ` | Caras ${cut.faces}`;
                    }

                    listItem.innerHTML = `
                        <span class="cut-info" data-ral="${ral}" data-index="${index}" style="color: ${textColor};">${cutText}</span>
                        <button class="remove-btn" data-ral="${ral}" data-index="${index}">Quitar</button>
                    `;
                    cutList.appendChild(listItem);
                });
                resultsContainer.appendChild(colorDiv);
            }
        }

        addCutBtn.addEventListener('click', () => {
            const ral = ralSelect.value;
            const long = parseInt(longInput.value);
            const short = parseInt(shortInput.value);
            const faces = parseInt(facesSelect.value);
            const count = parseInt(countInput.value);

            if (long > 0 && short > 0 && count > 0) {
                const l = Math.max(long, short);
                const s = Math.min(long, short);

                if (!cutsByRAL[ral]) {
                    cutsByRAL[ral] = [];
                }

                let existingCut = cutsByRAL[ral].find(cut => cut.long === l && cut.short === s && cut.faces === faces);
                if (existingCut) {
                    existingCut.count += count;
                } else {
                    cutsByRAL[ral].push({ long: l, short: s, faces: faces, count });
                }

                saveCuts();
                renderCuts();
                alert('Recorte añadido con éxito.');
                longInput.value = '';
                shortInput.value = '';
                countInput.value = '1';
            } else {
                alert('Por favor, introduce valores válidos para el largo, corto y número de chapas.');
            }
        });

        sortLongBtn.addEventListener('click', () => {
            currentSortOrder = 'long';
            renderCuts();
        });

        sortShortBtn.addEventListener('click', () => {
            currentSortOrder = 'short';
            renderCuts();
        });

        searchCutBtn.addEventListener('click', () => {
            const searchRal = searchRalSelect.value;
            const searchLong = parseInt(searchLongInput.value);
            const searchShort = parseInt(searchShortInput.value);

            searchResultsContainer.innerHTML = '';
            searchResultsContainer.className = 'search-results-container';

            if (searchLong <= 0 || searchShort <= 0) {
                searchResultsContainer.innerHTML = `<p class="search-result-item">Por favor, introduce medidas válidas para la búsqueda.</p>`;
                searchResultsContainer.classList.add('no-results');
                return;
            }

            const searchLongNormalized = Math.max(searchLong, searchShort);
            const searchShortNormalized = Math.min(searchLong, searchShort);

            const foundCuts = [];

            if (searchRal === 'all') {
                for (const ral in cutsByRAL) {
                    let bestMatchForColor = null;
                    let minWasteAreaForColor = Infinity;

                    cutsByRAL[ral].forEach(cut => {
                        let canFit = false;
                        let potentialWaste = Infinity;

                        if (cut.long >= searchLongNormalized && cut.short >= searchShortNormalized) {
                            canFit = true;
                            potentialWaste = cut.long * cut.short - searchLongNormalized * searchShortNormalized;
                        }

                        if (cut.long >= searchShortNormalized && cut.short >= searchLongNormalized) {
                            const rotatedWaste = cut.long * cut.short - searchLongNormalized * searchShortNormalized;
                            if (rotatedWaste < potentialWaste) {
                                canFit = true;
                                potentialWaste = rotatedWaste;
                            }
                        }

                        if (canFit && potentialWaste < minWasteAreaForColor) {
                            minWasteAreaForColor = potentialWaste;
                            bestMatchForColor = { ...cut, ral: ral };
                        }
                    });

                    if (bestMatchForColor) {
                        foundCuts.push(bestMatchForColor);
                    }
                }
            } else {
                const relevantCuts = cutsByRAL[searchRal] || [];
                let bestMatch = null;
                let minWasteArea = Infinity;
                
                relevantCuts.forEach(cut => {
                    let canFit = false;
                    let potentialWaste = Infinity;

                    if (cut.long >= searchLongNormalized && cut.short >= searchShortNormalized) {
                        canFit = true;
                        potentialWaste = cut.long * cut.short - searchLongNormalized * searchShortNormalized;
                    }

                    if (cut.long >= searchShortNormalized && cut.short >= searchLongNormalized) {
                        const rotatedWaste = cut.long * cut.short - searchLongNormalized * searchShortNormalized;
                        if (rotatedWaste < potentialWaste) {
                            canFit = true;
                            potentialWaste = rotatedWaste;
                        }
                    }

                    if (canFit && potentialWaste < minWasteArea) {
                        minWasteArea = potentialWaste;
                        bestMatch = { ...cut, ral: searchRal };
                    }
                });
                
                if (bestMatch) {
                    foundCuts.push(bestMatch);
                }
            }

            if (foundCuts.length > 0) {
                foundCuts.forEach(cut => {
                    const colorName = ralColors[cut.ral] ? ralColors[cut.ral].name : '';
                    let searchText = `RAL ${cut.ral} - ${colorName} | ${cut.long} X ${cut.short} | ${cut.count}`;
                    if (cut.faces === 2) {
                        searchText += ` | Caras ${cut.faces}`;
                    }
                    const p = document.createElement('p');
                    p.className = 'search-result-item';
                    p.textContent = searchText;
                    searchResultsContainer.appendChild(p);
                });
            } else {
                searchResultsContainer.innerHTML = `<p class="search-result-item">No se encontraron chapas que cumplan con las medidas especificadas.</p>`;
                searchResultsContainer.classList.add('no-results');
            }
        });


        resultsContainer.addEventListener('click', (event) => {
            const target = event.target;
            // Manejar la eliminación
            if (target.classList.contains('remove-btn')) {
                const button = target;
                const ral = button.dataset.ral;
                const index = parseInt(button.dataset.index);

                if (cutsByRAL[ral] && cutsByRAL[ral][index]) {
                    cutsByRAL[ral].splice(index, 1);
                    if (cutsByRAL[ral].length === 0) {
                        delete cutsByRAL[ral];
                    }
                    saveCuts();
                    renderCuts();
                }
            }
            // Manejar la edición al hacer clic en la info de la chapa
            if (target.classList.contains('cut-info')) {
                const ral = target.dataset.ral;
                const index = parseInt(target.dataset.index);
                const cut = cutsByRAL[ral][index];

                if (cut) {
                    modalLongInput.value = cut.long;
                    modalShortInput.value = cut.short;
                    modalFacesSelect.value = cut.faces;
                    modalCountInput.value = cut.count;

                    currentEditInfo = { ral, index, originalLong: cut.long, originalShort: cut.short, originalFaces: cut.faces };

                    editModal.style.display = 'block';
                }
            }
        });

        // Eventos del modal
        closeBtn.addEventListener('click', () => {
            editModal.style.display = 'none';
        });

        cancelEditBtn.addEventListener('click', () => {
            editModal.style.display = 'none';
        });

        window.addEventListener('click', (event) => {
            if (event.target === editModal) {
                editModal.style.display = 'none';
            }
        });

        saveEditBtn.addEventListener('click', () => {
            const { ral, index } = currentEditInfo;
            const newLong = parseInt(modalLongInput.value);
            const newShort = parseInt(modalShortInput.value);
            const newFaces = parseInt(modalFacesSelect.value);
            const newCount = parseInt(modalCountInput.value);

            if (newLong > 0 && newShort > 0 && newCount >= 0) {
                const l = Math.max(newLong, newShort);
                const s = Math.min(newLong, newShort);

                let existingCut = cutsByRAL[ral].find(cut => cut.long === l && cut.short === s && cut.faces === newFaces);

                if (existingCut && existingCut !== cutsByRAL[ral][index]) {
                    existingCut.count += newCount;
                    cutsByRAL[ral].splice(index, 1);
                } else if (newCount === 0) {
                    cutsByRAL[ral].splice(index, 1);
                } else {
                    cutsByRAL[ral][index].long = l;
                    cutsByRAL[ral][index].short = s;
                    cutsByRAL[ral][index].faces = newFaces;
                    cutsByRAL[ral][index].count = newCount;
                }

                if (cutsByRAL[ral].length === 0) {
                    delete cutsByRAL[ral];
                }

                saveCuts();
                renderCuts();
                editModal.style.display = 'none';
            } else {
                alert('Por favor, introduce valores válidos para el largo, corto, caras y cantidad.');
            }
        });

        // Funciones de importación/exportación
        exportJsonBtn.addEventListener('click', () => {
            const data = JSON.stringify(cutsByRAL, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'chapas_db.json';
            a.click();
            URL.revokeObjectURL(url);
            alert('Base de datos exportada a JSON con éxito.');
        });

        exportCsvBtn.addEventListener('click', () => {
            const header = 'RAL,Largo,Corto,Caras,Cantidad\n';
            let csv = header;
            for (const ral in cutsByRAL) {
                cutsByRAL[ral].forEach(cut => {
                    csv += `${ral},${cut.long},${cut.short},${cut.faces},${cut.count}\n`;
                });
            }
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'chapas_db.csv';
            a.click();
            URL.revokeObjectURL(url);
            alert('Base de datos exportada a CSV con éxito.');
        });

        // Función de exportación para iOS
        async function shareFile(data, fileName, mimeType) {
            try {
                const file = new File([data], fileName, { type: mimeType });
                if (navigator.canShare && navigator.canShare({ files: [file] })) {
                    await navigator.share({
                        files: [file],
                        title: 'Base de datos de chapas',
                        text: 'Aquí está la base de datos de recortes de chapa.'
                    });
                } else {
                    alert('Tu navegador no soporta la función de compartir archivos.');
                }
            } catch (error) {
                console.error('Error al compartir el archivo:', error);
                alert('Error al compartir el archivo. Por favor, inténtalo de nuevo.');
            }
        }

        exportJsonIosBtn.addEventListener('click', () => {
            const data = JSON.stringify(cutsByRAL, null, 2);
            const now = new Date();
            const fileName = `chapas_db_${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')}_${now.getHours().toString().padStart(2, '0')}-${now.getMinutes().toString().padStart(2, '0')}.json`;
            shareFile(data, fileName, 'application/json');
        });

        exportCsvIosBtn.addEventListener('click', () => {
            const header = 'RAL,Largo,Corto,Caras,Cantidad\n';
            let csv = header;
            for (const ral in cutsByRAL) {
                cutsByRAL[ral].forEach(cut => {
                    csv += `${ral},${cut.long},${cut.short},${cut.faces},${cut.count}\n`;
                });
            }
            const now = new Date();
            const fileName = `chapas_db_${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')}_${now.getHours().toString().padStart(2, '0')}-${now.getMinutes().toString().padStart(2, '0')}.csv`;
            shareFile(csv, fileName, 'text/csv');
        });

        importBtn.addEventListener('click', () => {
            importFile.click();
        });

        importFile.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (!file) {
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                const fileContent = e.target.result;
                if (file.name.endsWith('.json')) {
                    try {
                        const importedData = JSON.parse(fileContent);
                        if (importedData && typeof importedData === 'object') {
                            cutsByRAL = importedData;
                            saveCuts();
                            renderCuts();
                            alert('Base de datos importada desde JSON con éxito.');
                        } else {
                            alert('Error: El archivo JSON no es un formato de base de datos válido.');
                        }
                    } catch (error) {
                        alert('Error al leer el archivo JSON. Asegúrate de que es un archivo JSON válido.');
                    }
                } else if (file.name.endsWith('.csv')) {
                    const lines = fileContent.split('\n');
                    const importedData = {};
                    lines.forEach(line => {
                        const [ral, long, short, faces, count] = line.trim().split(',');
                        if (ral && !isNaN(long) && !isNaN(short) && !isNaN(faces) && !isNaN(count)) {
                            if (!importedData[ral]) {
                                importedData[ral] = [];
                            }
                            importedData[ral].push({
                                long: parseInt(long),
                                short: parseInt(short),
                                faces: parseInt(faces),
                                count: parseInt(count)
                            });
                        }
                    });
                    cutsByRAL = importedData;
                    saveCuts();
                    renderCuts();
                    alert('Base de datos importada desde CSV con éxito.');
                } else {
                    alert('Formato de archivo no soportado. Por favor, selecciona un archivo .json o .csv.');
                }
            };
            reader.readAsText(file);
        });

        renderCuts();
    });
</script>

</body>
</html>
